# SuperAdmin é¡¹ç›®æŠ€æœ¯æ¶æ„è¯„ä¼°ä¸è§„åˆ’

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **è¯„ä¼°æ—¥æœŸ**: 2025å¹´10æœˆ  
> **è¯„ä¼°äºº**: é¡¹ç›®æ¶æ„å¸ˆ  
> **é¡¹ç›®é˜¶æ®µ**: è¿è¥ç»´æŠ¤æœŸ

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€é¡¹ç›®æ¦‚å†µ](#ä¸€é¡¹ç›®æ¦‚å†µ)
- [äºŒã€æŠ€æœ¯æ¶æ„è¯„ä¼°](#äºŒæŠ€æœ¯æ¶æ„è¯„ä¼°)
- [ä¸‰ã€æŠ€æœ¯æ ˆåˆ†æ](#ä¸‰æŠ€æœ¯æ ˆåˆ†æ)
- [å››ã€æ¶æ„è®¾è®¡å»ºè®®](#å››æ¶æ„è®¾è®¡å»ºè®®)
- [äº”ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#äº”æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
- [å…­ã€å®‰å…¨æ¶æ„è®¾è®¡](#å…­å®‰å…¨æ¶æ„è®¾è®¡)
- [ä¸ƒã€æ‰©å±•æ€§ä¸å¯ç»´æŠ¤æ€§](#ä¸ƒæ‰©å±•æ€§ä¸å¯ç»´æŠ¤æ€§)
- [å…«ã€å¼€å‘ä¸éƒ¨ç½²è§„èŒƒ](#å…«å¼€å‘ä¸éƒ¨ç½²è§„èŒƒ)
- [ä¹ã€å®æ–½è·¯çº¿å›¾](#ä¹å®æ–½è·¯çº¿å›¾)

---

## ä¸€ã€é¡¹ç›®æ¦‚å†µ

### 1.1 é¡¹ç›®åŸºæœ¬ä¿¡æ¯

**é¡¹ç›®åç§°**: SuperAdmin  
**é¡¹ç›®ç±»å‹**: ä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿ  
**æŠ€æœ¯æ¶æ„**: å‰åç«¯åˆ†ç¦»  
**å¼€å‘å›¢é˜Ÿ**: ä¸­å°å‹å›¢é˜Ÿ  
**ç”¨æˆ·è§„æ¨¡**: ä¸­ç­‰è§„æ¨¡ä¼ä¸šåº”ç”¨

### 1.2 æŠ€æœ¯æ ˆæ¦‚è§ˆ

**åç«¯æŠ€æœ¯æ ˆ**:
- PHP 8.0.2+
- ThinkPHP 8.1.1
- MySQL (é»˜è®¤æ•°æ®åº“)
- Redis (ç¼“å­˜/é˜Ÿåˆ—)

**å‰ç«¯æŠ€æœ¯æ ˆ**:
- Vue 3.5.22
- Element Plus 2.9.1
- TypeScript 5.7.2
- Vite 6.3.5
- Pinia 2.3.0

### 1.3 å½“å‰æ¶æ„è¯„åˆ†

| è¯„ä¼°ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|---------|------|------|
| **æ¶æ„åˆç†æ€§** | â­â­â­â­ (8/10) | å‰åç«¯åˆ†ç¦»æ¶æ„åˆç†,Serviceå±‚å·²å¼•å…¥ |
| **æŠ€æœ¯å…ˆè¿›æ€§** | â­â­â­â­ (8/10) | ä½¿ç”¨ç°ä»£åŒ–æŠ€æœ¯æ ˆ,ç‰ˆæœ¬è¾ƒæ–° |
| **ä»£ç è´¨é‡** | â­â­â­ (7/10) | ä»£ç è§„èŒƒè¾ƒå¥½,éœ€æŒç»­æ”¹è¿› |
| **æ€§èƒ½è¡¨ç°** | â­â­â­ (6/10) | åŸºç¡€æ€§èƒ½å¯æ¥å—,éœ€ä¼˜åŒ– |
| **å®‰å…¨æ€§** | â­â­â­â­ (8/10) | å…·å¤‡åŸºæœ¬å®‰å…¨æœºåˆ¶ |
| **å¯æ‰©å±•æ€§** | â­â­â­ (7/10) | æ¨¡å—åŒ–è®¾è®¡è‰¯å¥½ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­ (8/10) | æ–‡æ¡£å®Œå–„,æ¶æ„æ¸…æ™° |
| **æµ‹è¯•è¦†ç›–** | â­â­ (4/10) | ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯• |

**æ€»ä½“è¯„åˆ†**: 7.0/10 (è‰¯å¥½,å·²æœ‰æ˜¾è‘—æ”¹è¿›)

---

## äºŒã€æŠ€æœ¯æ¶æ„è¯„ä¼°

### 2.1 ç³»ç»Ÿæ¶æ„ç°çŠ¶

#### 2.1.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚ (Client)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   PCæµè§ˆå™¨    â”‚  â”‚  ç§»åŠ¨æµè§ˆå™¨   â”‚  â”‚   APIå®¢æˆ·ç«¯   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WebæœåŠ¡å™¨ (Nginx)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            è´Ÿè½½å‡è¡¡ / åå‘ä»£ç† / SSLç»ˆæ­¢               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   é™æ€èµ„æºæœåŠ¡å™¨      â”‚  â”‚   PHP-FPMåº”ç”¨æœåŠ¡å™¨  â”‚
    â”‚   (Vue3 SPA)        â”‚  â”‚   (ThinkPHP 8)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                            â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MySQLæ•°æ®åº“   â”‚  â”‚   Redisç¼“å­˜/é˜Ÿåˆ—  â”‚  â”‚   æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.1.2 åº”ç”¨å±‚æ¶æ„ (å·²æ”¹è¿› âœ…)

```
app/
â”œâ”€â”€ admin/              # åå°ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ controller/     # æ§åˆ¶å™¨å±‚ (HTTPäº¤äº’)
â”‚   â”œâ”€â”€ model/          # æ¨¡å‹å±‚ (æ•°æ®è®¿é—®)
â”‚   â”œâ”€â”€ validate/       # éªŒè¯å™¨å±‚
â”‚   â””â”€â”€ library/        # ä¸šåŠ¡ç±»åº“
â”œâ”€â”€ api/                # APIæ¨¡å—
â”‚   â”œâ”€â”€ controller/     # APIæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ model/          # APIæ¨¡å‹
â”‚   â””â”€â”€ validate/       # APIéªŒè¯å™¨
â”œâ”€â”€ common/             # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ controller/     # å…¬å…±æ§åˆ¶å™¨åŸºç±»
â”‚   â”œâ”€â”€ model/          # å…¬å…±æ¨¡å‹
â”‚   â”œâ”€â”€ library/        # å…¬å…±ç±»åº“
â”‚   â””â”€â”€ middleware/     # ä¸­é—´ä»¶
â””â”€â”€ service/            # â­ Serviceå±‚ (ä¸šåŠ¡é€»è¾‘)
    â”œâ”€â”€ BaseService.php      # åŸºç¡€æœåŠ¡ç±»
    â”œâ”€â”€ UserService.php      # ç”¨æˆ·æœåŠ¡
    â”œâ”€â”€ AuthService.php      # è®¤è¯æœåŠ¡
    â””â”€â”€ [å…¶ä»–Service]        # å¾…æ‰©å±•
```

### 2.2 æ¶æ„ä¼˜åŠ¿åˆ†æ

#### âœ… æ ¸å¿ƒä¼˜åŠ¿

1. **æ¸…æ™°çš„åˆ†å±‚æ¶æ„** (å·²æ”¹è¿›)
   - Controller: HTTPäº¤äº’å±‚
   - Service: ä¸šåŠ¡é€»è¾‘å±‚  
   - Model: æ•°æ®è®¿é—®å±‚
   - èŒè´£åˆ†ç¦»æ˜ç¡®,æ˜“äºç»´æŠ¤

2. **å‰åç«¯åˆ†ç¦»æ¶æ„**
   - Vue 3 + TypeScript ç°ä»£åŒ–å‰ç«¯
   - RESTful API æ ‡å‡†æ¥å£
   - æ”¯æŒå¤šç«¯æ¥å…¥

3. **æ¨¡å—åŒ–è®¾è®¡**
   - admin/api/common æ¨¡å—åˆ’åˆ†åˆç†
   - æ”¯æŒæ’ä»¶åŒ–æ‰©å±•
   - æ¨¡å—é—´ä½è€¦åˆ

4. **å®Œå–„çš„æƒé™ç³»ç»Ÿ**
   - RBAC æƒé™æ¨¡å‹
   - èœå•æƒé™ + æ•°æ®æƒé™
   - Token è®¤è¯æœºåˆ¶

### 2.3 å¾…æ”¹è¿›é¡¹

#### âš ï¸ éœ€è¦å…³æ³¨çš„é—®é¢˜

1. **Serviceå±‚æ¨å¹¿** (ä¸­ç­‰ä¼˜å…ˆçº§ ğŸŸ¡)
   - âœ… å·²åˆ›å»ºåŸºç¡€æ¡†æ¶
   - âš ï¸ éœ€è¦åœ¨å…¶ä»–æ¨¡å—æ¨å¹¿ä½¿ç”¨
   - ğŸ”„ åˆ¶å®šServiceå±‚å¼€å‘è§„èŒƒ

2. **ç¼“å­˜ç­–ç•¥å®Œå–„** (é«˜ä¼˜å…ˆçº§ ğŸ”´)
   - Redis ç¼“å­˜æœªå……åˆ†åˆ©ç”¨
   - ç¼ºå°‘ç¼“å­˜é¢„çƒ­æœºåˆ¶
   - éœ€è¦é˜²æ­¢ç¼“å­˜ç©¿é€/å‡»ç©¿

3. **è‡ªåŠ¨åŒ–æµ‹è¯•** (é«˜ä¼˜å…ˆçº§ ğŸ”´)
   - ç¼ºå°‘å•å…ƒæµ‹è¯•
   - ç¼ºå°‘é›†æˆæµ‹è¯•
   - éœ€å¼•å…¥æµ‹è¯•æ¡†æ¶

4. **æ—¥å¿—ç›‘æ§** (ä¸­ç­‰ä¼˜å…ˆçº§ ğŸŸ¡)
   - æ—¥å¿—è®°å½•ä¸è§„èŒƒ
   - ç¼ºå°‘é“¾è·¯è¿½è¸ª
   - éœ€è¦æ—¥å¿—åˆ†æç³»ç»Ÿ

---

## ä¸‰ã€æŠ€æœ¯æ ˆåˆ†æ

### 3.1 åç«¯æŠ€æœ¯æ ˆ

#### 3.1.1 PHP 8.0+ è¯„ä¼°

**é€‰å‹è¯„åˆ†**: â­â­â­â­â­ (9/10)

**ä¼˜åŠ¿**:
- âœ… JITç¼–è¯‘å™¨æ˜¾è‘—æå‡æ€§èƒ½
- âœ… è”åˆç±»å‹ã€å‘½åå‚æ•°ç­‰æ–°ç‰¹æ€§
- âœ… æ”¹è¿›çš„é”™è¯¯å¤„ç†
- âœ… ç”Ÿæ€æˆç†Ÿ,ç¤¾åŒºæ´»è·ƒ

**å»ºè®®**:
```php
// âœ… ä½¿ç”¨PHP 8æ–°ç‰¹æ€§

// è”åˆç±»å‹
function getUserData(int|string $id): User|null {
    return User::find($id);
}

// å‘½åå‚æ•°
$user = createUser(
    username: 'admin',
    email: 'admin@example.com',
    group: 1
);

// Matchè¡¨è¾¾å¼
$status = match($code) {
    200 => 'success',
    404 => 'not_found',
    500 => 'error',
    default => 'unknown'
};

// æ„é€ å™¨å±æ€§æå‡
class User {
    public function __construct(
        public string $username,
        public string $email,
        private string $password
    ) {}
}
```

#### 3.1.2 ThinkPHP 8.1 è¯„ä¼°

**é€‰å‹è¯„åˆ†**: â­â­â­â­ (8/10)

**ä¼˜åŠ¿**:
- âœ… å›½å†…ä¸»æµæ¡†æ¶,æ–‡æ¡£é½å…¨
- âœ… æ”¯æŒå¤šåº”ç”¨æ¨¡å¼
- âœ… ORMåŠŸèƒ½å¼ºå¤§
- âœ… ä¸­é—´ä»¶æœºåˆ¶å®Œå–„

**æœ€ä½³å®è·µ**:
```php
// âœ… æ¨èçš„æŸ¥è¯¢å†™æ³•

// ä½¿ç”¨æŸ¥è¯¢æ„é€ å™¨
$users = User::where('status', 'enable')
    ->with('group')  // é¢„åŠ è½½å…³è”
    ->field('id,username,email')  // åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
    ->order('id desc')
    ->limit(10)
    ->select();

// ä½¿ç”¨äº‹åŠ¡
Db::transaction(function() {
    $user = User::create($data);
    UserWallet::create(['user_id' => $user->id]);
    return $user;
});

// é¿å…N+1æŸ¥è¯¢
$users = User::with(['group', 'wallet'])->select();
```

#### 3.1.3 æ•°æ®åº“æ–¹æ¡ˆè¯„ä¼°

| æŠ€æœ¯ | ç”¨é€” | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|-----|------|--------|------|
| MySQL 8.0 | ä¸»æ•°æ®å­˜å‚¨ | â­â­â­â­â­ | âœ… å·²ä½¿ç”¨ |
| Redis | ç¼“å­˜/Session/é˜Ÿåˆ— | â­â­â­â­â­ | ğŸ”„ éœ€å®Œå–„ |
| Elasticsearch | å…¨æ–‡æœç´¢ | â­â­â­ | ğŸ’¡ å¯é€‰ |
| MongoDB | éç»“æ„åŒ–æ•°æ® | â­â­ | ğŸ’¡ æš‚ä¸éœ€è¦ |

**MySQLä¼˜åŒ–å»ºè®®**:
```sql
-- âœ… æ·»åŠ å¿…è¦çš„ç´¢å¼•
CREATE INDEX idx_username ON ba_user(username);
CREATE INDEX idx_status_create_time ON ba_user(status, create_time);

-- âœ… ä½¿ç”¨EXPLAINåˆ†ææ…¢æŸ¥è¯¢
EXPLAIN SELECT * FROM ba_user WHERE username = 'admin';

-- âœ… é¿å…SELECT *
SELECT id, username, email FROM ba_user WHERE status = 'enable';

-- âœ… ä½¿ç”¨æ‰¹é‡æ’å…¥
INSERT INTO ba_user (username, email) VALUES 
    ('user1', 'user1@example.com'),
    ('user2', 'user2@example.com');
```

### 3.2 å‰ç«¯æŠ€æœ¯æ ˆ

#### 3.2.1 Vue 3 è¯„ä¼°

**é€‰å‹è¯„åˆ†**: â­â­â­â­â­ (10/10)

**ä¼˜åŠ¿**:
- âœ… Composition API æé«˜ä»£ç å¤ç”¨
- âœ… æ€§èƒ½ä¼˜äº Vue 2
- âœ… TypeScript æ”¯æŒä¼˜ç§€
- âœ… ç”Ÿæ€æˆç†Ÿ

**æœ€ä½³å®è·µ**:
```typescript
// âœ… æ¨è: ä½¿ç”¨Composition API + <script setup>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useUserStore } from '@/stores/user'

// å“åº”å¼æ•°æ®
const userList = ref<User[]>([])
const loading = ref(false)

// è®¡ç®—å±æ€§
const activeUsers = computed(() => 
    userList.value.filter(u => u.status === 'enable')
)

// ç”Ÿå‘½å‘¨æœŸ
onMounted(async () => {
    await loadUsers()
})

// æ–¹æ³•
async function loadUsers() {
    loading.value = true
    try {
        const res = await getUserList()
        userList.value = res.data.list
    } finally {
        loading.value = false
    }
}
</script>
```

#### 3.2.2 TypeScript è¯„ä¼°

**é€‰å‹è¯„åˆ†**: â­â­â­â­â­ (9/10)

**æ”¹è¿›å»ºè®®**:
```typescript
// âŒ é¿å…ä½¿ç”¨ any
function getData(): any {
    return {}
}

// âœ… å®šä¹‰æ˜ç¡®çš„ç±»å‹
interface UserData {
    id: number
    username: string
    email: string
    status: 'enable' | 'disable'
}

function getData(): UserData {
    return {
        id: 1,
        username: 'admin',
        email: 'admin@example.com',
        status: 'enable'
    }
}

// âœ… ä½¿ç”¨æ³›å‹
interface ApiResponse<T> {
    code: number
    msg: string
    data: T
}

async function request<T>(url: string): Promise<ApiResponse<T>> {
    const response = await fetch(url)
    return response.json()
}
```

---

## å››ã€æ¶æ„è®¾è®¡å»ºè®®

### 4.1 æ ‡å‡†åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Controller å±‚ (HTTPäº¤äº’)          â”‚
â”‚  â€¢ æ¥æ”¶è¯·æ±‚å‚æ•°                            â”‚
â”‚  â€¢ è°ƒç”¨ Service å¤„ç†ä¸šåŠ¡                   â”‚
â”‚  â€¢ è¿”å›å“åº”ç»“æœ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Service å±‚ (ä¸šåŠ¡é€»è¾‘)             â”‚
â”‚  â€¢ å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘                        â”‚
â”‚  â€¢ ç¼–æ’å¤šä¸ª Model æ“ä½œ                     â”‚
â”‚  â€¢ äº‹åŠ¡ç®¡ç†                               â”‚
â”‚  â€¢ ç¼“å­˜å¤„ç†                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Model å±‚ (æ•°æ®è®¿é—®)              â”‚
â”‚  â€¢ ORM æ¨¡å‹å®šä¹‰                           â”‚
â”‚  â€¢ æ•°æ®åº“æ“ä½œ                             â”‚
â”‚  â€¢ å…³è”å…³ç³»                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 RESTful API è®¾è®¡è§„èŒƒ

#### 4.2.1 èµ„æºå‘½å

```
âœ… æ¨è
GET    /api/users           # è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/users/1         # è·å–ç”¨æˆ·è¯¦æƒ…
POST   /api/users           # åˆ›å»ºç”¨æˆ·
PUT    /api/users/1         # æ›´æ–°ç”¨æˆ·
DELETE /api/users/1         # åˆ é™¤ç”¨æˆ·
GET    /api/users/1/orders  # è·å–ç”¨æˆ·çš„è®¢å•

âŒ ä¸æ¨è
GET    /api/getUserList
POST   /api/addUser
POST   /api/user/update
```

#### 4.2.2 ç»Ÿä¸€å“åº”æ ¼å¼

```json
{
    "code": 1,              // ä¸šåŠ¡çŠ¶æ€ç : 1=æˆåŠŸ, 0=å¤±è´¥
    "msg": "success",       // æç¤ºä¿¡æ¯
    "data": {              // å“åº”æ•°æ®
        "id": 1,
        "username": "admin"
    },
    "time": 1698765432     // æœåŠ¡å™¨æ—¶é—´æˆ³
}
```

#### 4.2.3 HTTP çŠ¶æ€ç è§„èŒƒ

```
200 OK                    # GET/PUT æˆåŠŸ
201 Created               # POST åˆ›å»ºæˆåŠŸ
204 No Content            # DELETE æˆåŠŸ
400 Bad Request           # è¯·æ±‚å‚æ•°é”™è¯¯
401 Unauthorized          # æœªç™»å½•
403 Forbidden             # æ— æƒé™
404 Not Found             # èµ„æºä¸å­˜åœ¨
422 Unprocessable Entity  # éªŒè¯å¤±è´¥
429 Too Many Requests     # è¯·æ±‚è¿‡äºé¢‘ç¹
500 Internal Server Error # æœåŠ¡å™¨é”™è¯¯
```

### 4.3 æ•°æ®åº“è®¾è®¡è§„èŒƒ

#### 4.3.1 è¡¨è®¾è®¡è§„èŒƒ

```sql
-- âœ… æ¨èçš„è¡¨è®¾è®¡
CREATE TABLE `ba_user` (
    `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
    `username` VARCHAR(32) NOT NULL COMMENT 'ç”¨æˆ·å',
    `password` VARCHAR(255) NOT NULL COMMENT 'å¯†ç ',
    `email` VARCHAR(100) DEFAULT NULL COMMENT 'é‚®ç®±',
    `mobile` VARCHAR(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
    `status` ENUM('enable', 'disable') NOT NULL DEFAULT 'enable' COMMENT 'çŠ¶æ€',
    `create_time` INT UNSIGNED NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` INT UNSIGNED NOT NULL COMMENT 'æ›´æ–°æ—¶é—´',
    `delete_time` INT UNSIGNED DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´(è½¯åˆ é™¤)',
    UNIQUE KEY `uk_username` (`username`),
    UNIQUE KEY `uk_email` (`email`),
    KEY `idx_mobile` (`mobile`),
    KEY `idx_status_create` (`status`, `create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

**è®¾è®¡åŸåˆ™**:
1. âœ… ä½¿ç”¨ InnoDB å¼•æ“
2. âœ… å­—ç¬¦é›†ä½¿ç”¨ utf8mb4
3. âœ… ä¸»é”®ä½¿ç”¨è‡ªå¢ ID
4. âœ… æ·»åŠ å¿…è¦çš„ç´¢å¼•
5. âœ… å­—æ®µæ·»åŠ æ³¨é‡Š
6. âœ… ä½¿ç”¨æ—¶é—´æˆ³å­˜å‚¨æ—¶é—´
7. âœ… æ”¯æŒè½¯åˆ é™¤

---

## äº”ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 5.1 æ•°æ®åº“ä¼˜åŒ–

#### 5.1.1 æŸ¥è¯¢ä¼˜åŒ–

**é—®é¢˜**: N+1 æŸ¥è¯¢
```php
// âŒ ä¼šäº§ç”Ÿ N+1 æŸ¥è¯¢
$users = User::select();
foreach ($users as $user) {
    echo $user->group->name;  // æ¯æ¬¡å¾ªç¯éƒ½æŸ¥è¯¢æ•°æ®åº“
}

// âœ… ä½¿ç”¨é¢„åŠ è½½
$users = User::with('group')->select();
foreach ($users as $user) {
    echo $user->group->name;  // ä¸å†æŸ¥è¯¢æ•°æ®åº“
}
```

**é—®é¢˜**: æŸ¥è¯¢å…¨éƒ¨å­—æ®µ
```php
// âŒ æŸ¥è¯¢ä¸éœ€è¦çš„å­—æ®µ
$users = User::select();  // SELECT *

// âœ… åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
$users = User::field('id,username,email')->select();
```

**é—®é¢˜**: æœªä½¿ç”¨ç´¢å¼•
```php
// âŒ å‡½æ•°ä½œç”¨äºç´¢å¼•å­—æ®µ
User::whereRaw('DATE(create_time) = ?', [date('Y-m-d')])->select();

// âœ… ä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥è¯¢
$startTime = strtotime(date('Y-m-d'));
$endTime = $startTime + 86400;
User::where('create_time', 'between', [$startTime, $endTime])->select();
```

#### 5.1.2 ç´¢å¼•ä¼˜åŒ–

```sql
-- âœ… åˆ›å»ºåˆé€‚çš„ç´¢å¼•

-- å•åˆ—ç´¢å¼•
CREATE INDEX idx_username ON ba_user(username);

-- å¤åˆç´¢å¼• (é¡ºåºå¾ˆé‡è¦)
CREATE INDEX idx_status_create ON ba_user(status, create_time);

-- å”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX uk_email ON ba_user(email);

-- å…¨æ–‡ç´¢å¼•
CREATE FULLTEXT INDEX ft_content ON ba_article(title, content);
```

**ç´¢å¼•ä½¿ç”¨å»ºè®®**:
- WHERE æ¡ä»¶ä¸­çš„å­—æ®µ
- ORDER BY æ’åºçš„å­—æ®µ
- JOIN å…³è”çš„å­—æ®µ
- é«˜é€‰æ‹©æ€§çš„å­—æ®µ
- é¿å…è¿‡å¤šç´¢å¼•(å½±å“å†™å…¥æ€§èƒ½)

### 5.2 ç¼“å­˜ä¼˜åŒ–

#### 5.2.1 Redis ç¼“å­˜ç­–ç•¥

**ç¼“å­˜å±‚æ¬¡**:
```
1. æµè§ˆå™¨ç¼“å­˜ (é™æ€èµ„æº)
2. CDNç¼“å­˜ (å›¾ç‰‡/JS/CSS)
3. Nginxç¼“å­˜ (é¡µé¢ç¼“å­˜)
4. Redisç¼“å­˜ (æ•°æ®ç¼“å­˜)
5. MySQLæŸ¥è¯¢ç¼“å­˜
```

**ç¼“å­˜å®ç°**:
```php
namespace app\service;

use think\facade\Cache;

class UserService extends BaseService
{
    /**
     * è·å–ç”¨æˆ·ä¿¡æ¯ - å¸¦ç¼“å­˜
     */
    public function getUserById(int $userId): ?array
    {
        $cacheKey = "user:info:{$userId}";
        
        // ä»ç¼“å­˜è·å–
        $userInfo = Cache::get($cacheKey);
        
        if ($userInfo === null) {
            // ç¼“å­˜ä¸å­˜åœ¨,ä»æ•°æ®åº“æŸ¥è¯¢
            $user = User::find($userId);
            
            if ($user) {
                $userInfo = $user->toArray();
                // å†™å…¥ç¼“å­˜,æœ‰æ•ˆæœŸ 1å°æ—¶
                Cache::set($cacheKey, $userInfo, 3600);
            }
        }
        
        return $userInfo;
    }
    
    /**
     * æ›´æ–°ç”¨æˆ· - åˆ é™¤ç¼“å­˜
     */
    public function updateUser(int $userId, array $data): bool
    {
        $result = User::where('id', $userId)->update($data);
        
        if ($result) {
            // åˆ é™¤ç¼“å­˜
            Cache::delete("user:info:{$userId}");
        }
        
        return $result;
    }
}
```

#### 5.2.2 ç¼“å­˜é—®é¢˜é˜²æŠ¤

**é—®é¢˜1: ç¼“å­˜ç©¿é€** (æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®)
```php
// âœ… è§£å†³æ–¹æ¡ˆ: ç¼“å­˜ç©ºå€¼
public function getUserById(int $userId): ?array
{
    $cacheKey = "user:info:{$userId}";
    $userInfo = Cache::get($cacheKey);
    
    if ($userInfo === false) {
        // ç¼“å­˜çš„ç©ºå€¼
        return null;
    }
    
    if ($userInfo === null) {
        $user = User::find($userId);
        
        if ($user) {
            $userInfo = $user->toArray();
            Cache::set($cacheKey, $userInfo, 3600);
        } else {
            // ç¼“å­˜ç©ºå€¼,é˜²æ­¢ç©¿é€
            Cache::set($cacheKey, false, 60);
            return null;
        }
    }
    
    return $userInfo;
}
```

**é—®é¢˜2: ç¼“å­˜å‡»ç©¿** (çƒ­ç‚¹æ•°æ®è¿‡æœŸ)
```php
// âœ… è§£å†³æ–¹æ¡ˆ: åŠ é”æˆ–æ°¸ä¸è¿‡æœŸ
use think\facade\Cache;

public function getHotData(string $key): mixed
{
    $data = Cache::get($key);
    
    if ($data === null) {
        // ä½¿ç”¨åˆ†å¸ƒå¼é”
        $lockKey = "lock:{$key}";
        $lock = Cache::handler()->set($lockKey, 1, ['nx', 'ex' => 10]);
        
        if ($lock) {
            try {
                // è·å–åˆ°é”,æŸ¥è¯¢æ•°æ®åº“
                $data = $this->queryFromDatabase();
                Cache::set($key, $data, 3600);
            } finally {
                Cache::delete($lockKey);
            }
        } else {
            // æœªè·å–åˆ°é”,ç­‰å¾…åé‡è¯•
            usleep(100000);
            return $this->getHotData($key);
        }
    }
    
    return $data;
}
```

**é—®é¢˜3: ç¼“å­˜é›ªå´©** (å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ)
```php
// âœ… è§£å†³æ–¹æ¡ˆ: è¿‡æœŸæ—¶é—´åŠ éšæœºå€¼
Cache::set($key, $data, 3600 + mt_rand(0, 300));  // 3600-3900ç§’
```

### 5.3 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 5.3.1 æ„å»ºä¼˜åŒ–

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import compression from 'vite-plugin-compression'

export default defineConfig({
    plugins: [
        vue(),
        // Gzipå‹ç¼©
        compression({
            algorithm: 'gzip',
            ext: '.gz'
        })
    ],
    build: {
        // ä»£ç åˆ†å‰²
        rollupOptions: {
            output: {
                manualChunks: {
                    'element-plus': ['element-plus'],
                    'vue-vendor': ['vue', 'vue-router', 'pinia']
                }
            }
        },
        // å‹ç¼©
        minify: 'terser',
        terserOptions: {
            compress: {
                drop_console: true,  // åˆ é™¤console
                drop_debugger: true
            }
        }
    }
})
```

#### 5.3.2 åŠ è½½ä¼˜åŒ–

```vue
<!-- âœ… è·¯ç”±æ‡’åŠ è½½ -->
<script setup lang="ts">
const routes = [
    {
        path: '/user',
        component: () => import('@/views/user/index.vue')  // æ‡’åŠ è½½
    }
]
</script>

<!-- âœ… å›¾ç‰‡æ‡’åŠ è½½ -->
<img v-lazy="imageUrl" alt="description">

<!-- âœ… è™šæ‹Ÿæ»šåŠ¨ (å¤§åˆ—è¡¨) -->
<virtual-list
    :data-source="userList"
    :data-key="'id'"
    :item-size="50"
/>
```

### 5.4 åº”ç”¨æœåŠ¡å™¨ä¼˜åŒ–

#### 5.4.1 PHP-FPM é…ç½®

```ini
; /etc/php-fpm.d/www.conf

; è¿›ç¨‹ç®¡ç†æ–¹å¼
pm = dynamic

; æœ€å¤§å­è¿›ç¨‹æ•°
pm.max_children = 50

; å¯åŠ¨æ—¶è¿›ç¨‹æ•°
pm.start_servers = 10

; æœ€å°ç©ºé—²è¿›ç¨‹æ•°
pm.min_spare_servers = 5

; æœ€å¤§ç©ºé—²è¿›ç¨‹æ•°
pm.max_spare_servers = 20

; æ¯ä¸ªè¿›ç¨‹å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°
pm.max_requests = 1000

; æ…¢æ—¥å¿—
slowlog = /var/log/php-fpm/www-slow.log
request_slowlog_timeout = 3s
```

#### 5.4.2 Nginx é…ç½®

```nginx
# /etc/nginx/conf.d/superadmin.conf

server {
    listen 80;
    server_name example.com;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    gzip_min_length 1000;
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # åç«¯API
    location /api/ {
        proxy_pass http://127.0.0.1:9000;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # é™æµ
        limit_req zone=api burst=20 nodelay;
    }
    
    # å‰ç«¯é¡µé¢
    location / {
        root /var/www/html/web/dist;
        try_files $uri $uri/ /index.html;
    }
}

# é™æµé…ç½®
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
```

---

## å…­ã€å®‰å…¨æ¶æ„è®¾è®¡

### 6.1 è®¤è¯ä¸æˆæƒ

#### 6.1.1 Token è®¤è¯æœºåˆ¶

**å½“å‰å®ç°** (å·²æœ‰):
```php
// Tokenç”Ÿæˆ
$token = Random::uuid();
Token::set($token, 'user', $userId, 86400);

// TokenéªŒè¯
$tokenData = Token::get($token);
Token::tokenExpirationCheck($tokenData);

// Tokenåˆ é™¤
Token::delete($token);
```

**æ”¹è¿›å»ºè®®**:
```php
// âœ… ä½¿ç”¨JWT Token
use Firebase\JWT\JWT;
use Firebase\JWT\Key;

class JwtService
{
    private string $secret = 'your-secret-key';
    
    /**
     * ç”ŸæˆJWT Token
     */
    public function generateToken(int $userId, array $payload = []): string
    {
        $now = time();
        $expire = $now + 86400;  // 24å°æ—¶
        
        $token = [
            'iss' => 'superadmin',      // ç­¾å‘è€…
            'aud' => 'user',             // æ¥æ”¶è€…
            'iat' => $now,               // ç­¾å‘æ—¶é—´
            'exp' => $expire,            // è¿‡æœŸæ—¶é—´
            'uid' => $userId,            // ç”¨æˆ·ID
            