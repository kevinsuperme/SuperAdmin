# SuperAdmin v2.3.3 ç‰ˆæœ¬ç‰¹æ€§è¯´æ˜

> **é¡¹ç›®ç‰ˆæœ¬**: v2.3.3
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.1
> **æœ€åæ›´æ–°**: 2025-10-26
> **è¯´æ˜**: æœ¬æ–‡æ¡£åŸè®¡åˆ’ä¸º v2.4.0ï¼Œå®é™…åŠŸèƒ½å·²åœ¨ v2.3.3 ä¸­å®ç°

## ç‰ˆæœ¬æ¦‚è¿°

SuperAdmin v2.3.3 æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼ä¸šçº§åŠŸèƒ½å¢å¼ºç‰ˆæœ¬ï¼Œå¼•å…¥äº†å¤šä¸ªå…³é”®ç‰¹æ€§ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„è‡ªåŠ¨åŒ–ã€å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ‰ é‡å¤§æ›´æ–°

### 1. CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²ç³»ç»Ÿ

å®Œæ•´çš„æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²è§£å†³æ–¹æ¡ˆ,å®ç°ä»£ç ä»æäº¤åˆ°ç”Ÿäº§ç¯å¢ƒçš„å…¨è‡ªåŠ¨åŒ–æµç¨‹ã€‚

#### æ ¸å¿ƒç‰¹æ€§

- **GitHub Actions å·¥ä½œæµ**
  - è‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ£€æŸ¥ (PHPStan, PHP-CS-Fixer)
  - è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ (PHPUnit)
  - è‡ªåŠ¨åŒ–å®‰å…¨æ‰«æ
  - è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²

- **è·¨å¹³å°éƒ¨ç½²è„šæœ¬**
  - Linux éƒ¨ç½²è„šæœ¬: `scripts/deploy.sh`
  - Windows éƒ¨ç½²è„šæœ¬: `scripts/deploy.ps1`
  - æ”¯æŒå¤šç¯å¢ƒé…ç½® (å¼€å‘/æµ‹è¯•/ç”Ÿäº§)

- **å®Œæ•´çš„æ–‡æ¡£æ”¯æŒ**
  - GitHub Actions é…ç½®æŒ‡å—
  - éƒ¨ç½²æœ€ä½³å®è·µ
  - æ•…éšœæ’æŸ¥æ–‡æ¡£

#### ä½¿ç”¨æ–¹æ³•

```bash
# Linux ç¯å¢ƒéƒ¨ç½²
./scripts/deploy.sh /path/to/release.tar.gz /var/www/html

# Windows ç¯å¢ƒéƒ¨ç½²
.\scripts\deploy.ps1 -ReleasePackagePath "C:\path\to\release.zip" -WebRootPath "C:\inetpub\wwwroot"
```

#### é…ç½®è¦æ±‚

éœ€è¦åœ¨ GitHub ä»“åº“ä¸­é…ç½®ä»¥ä¸‹ Secrets:
- `DEPLOY_HOST`: éƒ¨ç½²æœåŠ¡å™¨åœ°å€
- `DEPLOY_USER`: éƒ¨ç½²ç”¨æˆ·å
- `DEPLOY_PATH`: éƒ¨ç½²è·¯å¾„
- `DEPLOY_KEY`: SSHç§é’¥

### 2. å®Œæ•´çš„æµ‹è¯•æ¡†æ¶

å»ºç«‹äº†å®Œå–„çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»,æé«˜ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚

#### æ ¸å¿ƒç»„ä»¶

- **PHPUnit é…ç½®** (`phpunit.xml`)
  - å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒé…ç½®
  - ä»£ç è¦†ç›–ç‡æ”¯æŒ
  - æµ‹è¯•å¥—ä»¶åˆ’åˆ†

- **æµ‹è¯•åŸºç±»** (`tests/TestCase.php`)
  - æä¾›é€šç”¨æµ‹è¯•å·¥å…·æ–¹æ³•
  - æ•°æ®åº“äº‹åŠ¡æ”¯æŒ
  - HTTP è¯·æ±‚æ¨¡æ‹Ÿ
  - æµ‹è¯•ç”¨æˆ·åˆ›å»ºå·¥å…·

- **æµ‹è¯•ç¤ºä¾‹**
  - å•å…ƒæµ‹è¯•: `tests/Unit/AuthServiceTest.php`
  - åŠŸèƒ½æµ‹è¯•: `tests/Feature/UserApiTest.php`

#### å¿«é€Ÿå¼€å§‹

```bash
# Linux/Mac
./test

# Windows
test.bat

# è¿è¡Œç‰¹å®šæµ‹è¯•
./vendor/bin/phpunit tests/Unit/AuthServiceTest.php

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./vendor/bin/phpunit --coverage-html coverage
```

### 3. å¥åº·æ£€æŸ¥ API

å®Œæ•´çš„ç³»ç»Ÿå¥åº·çŠ¶æ€ç›‘æ§æ¥å£,ä¾¿äºè¿ç»´ç›‘æ§å’Œæ•…éšœè¯Šæ–­ã€‚

#### å¯ç”¨ç«¯ç‚¹

**åŸºç¡€å¥åº·æ£€æŸ¥** - `/api/health/check`
```json
{
  "status": "healthy",
  "timestamp": "2025-10-26T08:00:00+08:00",
  "services": {
    "database": "ok",
    "cache": "ok",
    "filesystem": "ok"
  }
}
```

**è¯¦ç»†ç³»ç»Ÿä¿¡æ¯** - `/api/health/info`
```json
{
  "status": "healthy",
  "timestamp": "2025-10-26T08:00:00+08:00",
  "services": {
    "database": "ok",
    "cache": "ok",
    "filesystem": "ok"
  },
  "system": {
    "php_version": "8.1.0",
    "memory_usage": "15.2MB",
    "memory_limit": "256M",
    "disk_usage": "45%"
  }
}
```

#### ç›‘æ§æŒ‡æ ‡

- æ•°æ®åº“è¿æ¥çŠ¶æ€
- ç¼“å­˜æœåŠ¡çŠ¶æ€
- æ–‡ä»¶ç³»ç»ŸçŠ¶æ€
- PHP ç‰ˆæœ¬ä¿¡æ¯
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- ç£ç›˜ç©ºé—´ä½¿ç”¨

### 4. API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå™¨

åŸºäºä»£ç æ³¨é‡Šè‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£,æä¾›å¯è§†åŒ–ç®¡ç†ç•Œé¢ã€‚

#### æ ¸å¿ƒåŠŸèƒ½

- **è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ**
  - åŸºäº PHPDoc æ³¨é‡Šè‡ªåŠ¨ç”Ÿæˆ
  - æ”¯æŒå‚æ•°è¯´æ˜å’Œè¿”å›å€¼å®šä¹‰
  - è‡ªåŠ¨è¯†åˆ«è¯·æ±‚æ–¹æ³•

- **å¯è§†åŒ–ç®¡ç†ç•Œé¢**
  - ç¾è§‚çš„æ–‡æ¡£å±•ç¤º
  - åˆ†ç»„ç®¡ç†
  - æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
  - åœ¨çº¿æµ‹è¯•æ¥å£

#### ä½¿ç”¨ç¤ºä¾‹

åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­æ·»åŠ æ³¨é‡Š:

```php
/**
 * @title è·å–ç”¨æˆ·åˆ—è¡¨
 * @description è·å–åˆ†é¡µçš„ç”¨æˆ·åˆ—è¡¨æ•°æ®
 * @auth true
 * @method GET
 * @param page int é¡µç 
 * @param limit int æ¯é¡µæ•°é‡
 * @return array {
 *   "code": 1,
 *   "message": "success",
 *   "data": {
 *     "list": [],
 *     "total": 0
 *   }
 * }
 */
public function index()
{
    // å®ç°ä»£ç 
}
```

è®¿é—® `/admin/api-doc` æŸ¥çœ‹ç”Ÿæˆçš„æ–‡æ¡£ã€‚

### 5. å¢å¼ºçš„ä¸­é—´ä»¶ç³»ç»Ÿ

æä¾›æ›´å¼ºå¤§çš„è®¤è¯å’Œé™æµåŠŸèƒ½,ä¿æŠ¤ API å®‰å…¨ã€‚

#### EnhancedAuth ä¸­é—´ä»¶

- **å¤šç«¯è®¤è¯æ”¯æŒ**
  - ç®¡ç†å‘˜ç«¯è®¤è¯
  - ç”¨æˆ·ç«¯è®¤è¯
  - çµæ´»çš„ç«¯ç‚¹é…ç½®

- **JWT Token è‡ªåŠ¨åˆ·æ–°**
  - Token è¿‡æœŸè‡ªåŠ¨ç»­æœŸ
  - æ— æ„Ÿåˆ·æ–°ç”¨æˆ·ä½“éªŒ
  - å®‰å…¨çš„åˆ·æ–°æœºåˆ¶

- **ç»†ç²’åº¦æƒé™æ§åˆ¶**
  - æ¥å£çº§æƒé™éªŒè¯
  - èµ„æºçº§æƒé™æ§åˆ¶
  - è‡ªå®šä¹‰æƒé™è§„åˆ™

- **è¯·æ±‚æ—¥å¿—è®°å½•**
  - è‡ªåŠ¨è®°å½• API è®¿é—®æ—¥å¿—
  - ç”¨æˆ·æ“ä½œè¿½è¸ª
  - å®‰å…¨å®¡è®¡æ”¯æŒ

#### RateLimit ä¸­é—´ä»¶

- **è®¿é—®é¢‘ç‡é™åˆ¶**
  - IP çº§åˆ«é™æµ
  - ç”¨æˆ·çº§åˆ«é™æµ
  - çµæ´»çš„é™æµç­–ç•¥

- **å¯é…ç½®é™æµè§„åˆ™**
  - è‡ªå®šä¹‰æ—¶é—´çª—å£
  - è‡ªå®šä¹‰è¯·æ±‚æ¬¡æ•°
  - ç™½åå•æ”¯æŒ

- **å‹å¥½çš„é”™è¯¯æç¤º**
  - æ¸…æ™°çš„é™æµæç¤º
  - å‰©ä½™æ¬¡æ•°æ˜¾ç¤º
  - é‡è¯•æ—¶é—´æç¤º

#### ä½¿ç”¨ç¤ºä¾‹

```php
// åœ¨è·¯ç”±ä¸­å¯ç”¨ä¸­é—´ä»¶
Route::middleware(['enhanced_auth', 'rate_limit'])->group(function () {
    Route::get('users', 'User/index');
});
```

### 6. é…ç½®ä¼˜åŒ–

å®Œå–„äº†ç³»ç»Ÿé…ç½®,æä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚

#### Redis ç¼“å­˜é…ç½®

æä¾›å®Œæ•´çš„ Redis é…ç½®ç¤ºä¾‹:

```php
'default' => 'redis',
'stores' => [
    'redis' => [
        'type' => 'redis',
        'host' => '127.0.0.1',
        'port' => 6379,
        'password' => '',
        'select' => 0,
        'timeout' => 0,
        'expire' => 0,
        'persistent' => false,
        'prefix' => 'superadmin:',
    ],
],
```

#### å®Œå–„çš„ .gitignore

- å¿½ç•¥ IDE é…ç½®æ–‡ä»¶
- å¿½ç•¥ä¾èµ–ç›®å½•
- å¿½ç•¥æ—¥å¿—å’Œç¼“å­˜æ–‡ä»¶
- å¿½ç•¥æ•æ„Ÿé…ç½®æ–‡ä»¶

## ğŸ”§ æ¶æ„æ”¹è¿›

### æ–‡æ¡£æ›´æ–°

- **01-é¡¹ç›®æŠ€æœ¯æ¶æ„è¯„ä¼°ä¸è§„åˆ’.md**: å®Œå–„çš„é¡¹ç›®æ¶æ„æ–‡æ¡£
- **CI-CD.md**: CI/CD å®æ–½æŒ‡å—
- **08-æŠ€æœ¯æ¶æ„è¯„ä¼°æŠ¥å‘Š.md**: æŠ€æœ¯æ¶æ„è¯„ä¼°æŠ¥å‘Š
- **README.md**: æ›´æ–°äº†æ‰€æœ‰æ–°åŠŸèƒ½è¯´æ˜

### ä»£ç ä¼˜åŒ–

- ä¿®å¤ System.php æ§åˆ¶å™¨åŸºç±»å¼•ç”¨é”™è¯¯
- ä¼˜åŒ–æ•°æ®åº“é…ç½®æ–‡ä»¶æ³¨é‡Š
- å®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- æå‡ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
- ç»Ÿä¸€ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ

## ğŸ“ å‡çº§æŒ‡å—

### ä» v2.3.x å‡çº§

1. **å¤‡ä»½æ•°æ®**
   ```bash
   # å¤‡ä»½æ•°æ®åº“
   mysqldump -u root -p database_name > backup.sql
   
   # å¤‡ä»½æ–‡ä»¶
   tar -czf backup.tar.gz /path/to/project
   ```

2. **æ›´æ–°ä»£ç **
   ```bash
   git pull origin main
   ```

3. **æ›´æ–°ä¾èµ–**
   ```bash
   composer install
   cd web && npm install
   ```

4. **è¿è¡Œæµ‹è¯•**
   ```bash
   ./test
   ```

5. **é…ç½® CI/CD** (å¯é€‰)
   - å‚è€ƒ `docs/04-GitHub Actions CI-CDé…ç½®æŒ‡å—.md`
   - é…ç½® GitHub Secrets
   - å¯ç”¨ GitHub Actions

6. **æ›´æ–°ç¯å¢ƒé…ç½®**
   - æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ–°é…ç½®é¡¹
   - é…ç½® Redis (å¯é€‰)
   - æ›´æ–°æ•°æ®åº“é…ç½®

### æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æ¡†æ¶**
   - ä¸ºå…³é”®ä¸šåŠ¡é€»è¾‘ç¼–å†™æµ‹è¯•ç”¨ä¾‹
   - å®šæœŸè¿è¡Œæµ‹è¯•ç¡®ä¿ä»£ç è´¨é‡

2. **CI/CD åŠŸèƒ½**
   - éœ€è¦é…ç½® GitHub Actions
   - éœ€è¦å‡†å¤‡éƒ¨ç½²ç¯å¢ƒ
   - å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

3. **å¥åº·æ£€æŸ¥ API**
   - é»˜è®¤å¼€æ”¾è®¿é—®
   - ç”Ÿäº§ç¯å¢ƒå»ºè®®æ·»åŠ è®¿é—®æ§åˆ¶
   - å¯é…ç½®ç›‘æ§å‘Šè­¦

4. **é™æµä¸­é—´ä»¶**
   - é»˜è®¤å…³é—­
   - æ ¹æ®å®é™…éœ€æ±‚åœ¨è·¯ç”±ä¸­å¯ç”¨
   - æ³¨æ„é…ç½®åˆç†çš„é™æµé˜ˆå€¼

## ğŸš€ æœ€ä½³å®è·µ

### æµ‹è¯•é©±åŠ¨å¼€å‘

```bash
# å¼€å‘æ–°åŠŸèƒ½å‰å…ˆç¼–å†™æµ‹è¯•
./vendor/bin/phpunit --filter NewFeatureTest

# ç¡®ä¿æµ‹è¯•é€šè¿‡åå†æäº¤ä»£ç 
git add .
git commit -m "feat: add new feature"
```

### æŒç»­é›†æˆ

```yaml
# åœ¨ .github/workflows/ci-cd.yml ä¸­é…ç½®
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
```

### å¥åº·ç›‘æ§

```bash
# é…ç½®å®šæ—¶ä»»åŠ¡æ£€æŸ¥ç³»ç»Ÿå¥åº·
*/5 * * * * curl -f http://your-domain/api/health/check || alert-admin
```

### API æ–‡æ¡£ç»´æŠ¤

```php
// ä¸ºæ‰€æœ‰å…¬å…± API æ·»åŠ æ–‡æ¡£æ³¨é‡Š
/**
 * @title æ¥å£æ ‡é¢˜
 * @description æ¥å£æè¿°
 * @auth true
 * @method GET
 * @param name type å‚æ•°è¯´æ˜
 * @return array è¿”å›å€¼è¯´æ˜
 */
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions é…ç½®æŒ‡å—](04-GitHub Actions CI-CDé…ç½®æŒ‡å—.md)
- [CI/CD å®æ–½æŒ‡å—](../CI-CD.md)
- [æµ‹è¯•æ–‡æ¡£](../tests/README.md)
- [æ¶æ„æ–‡æ¡£](01-é¡¹ç›®æŠ€æœ¯æ¶æ„è¯„ä¼°ä¸è§„åˆ’.md)
- [æŠ€æœ¯æ¶æ„è¯„ä¼°](08-æŠ€æœ¯æ¶æ„è¯„ä¼°æŠ¥å‘Š.md)

## ğŸ¤ å‚ä¸è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request,ä¸€èµ·è®© SuperAdmin å˜å¾—æ›´å¥½!

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache License 2.0](../LICENSE) å¼€æºåè®®ã€‚