From 71f488022f0f82859937c0326eafba1896787820 Mon Sep 17 00:00:00 2001
From: kevinsuperme <iphone.com@live.cn>
Date: Sun, 26 Oct 2025 18:43:29 +0800
Subject: [PATCH 3/3] =?UTF-8?q?chore:=20=E6=9B=B4=E6=96=B0=E7=8E=AF?=
 =?UTF-8?q?=E5=A2=83=E9=85=8D=E7=BD=AE=E5=92=8C=E5=B7=A5=E4=BD=9C=E6=B5=81?=
 =?UTF-8?q?=E6=96=87=E4=BB=B6?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

更新.gitignore添加web环境文件忽略规则
添加web环境配置文件示例
更新CI/CD工作流使用pnpm替代npm
添加.env.example基础配置示例
更新.claude配置添加新命令
---
 .claude/settings.local.json |  3 +-
 .env.example                | 27 +++++++++++++++++
 .github/workflows/ci-cd.yml | 60 ++++++++++++++++++++++++++++---------
 .gitignore                  |  3 ++
 web/.env                    |  5 ----
 web/.env.example            | 11 +++++++
 6 files changed, 89 insertions(+), 20 deletions(-)
 create mode 100644 .env.example
 delete mode 100644 web/.env
 create mode 100644 web/.env.example

diff --git a/.claude/settings.local.json b/.claude/settings.local.json
index 257b4721..b64c253d 100644
--- a/.claude/settings.local.json
+++ b/.claude/settings.local.json
@@ -4,7 +4,8 @@
       "Bash(./vendor/bin/phpunit:*)",
       "Bash(awk:*)",
       "Bash(composer show:*)",
-      "Bash(1)"
+      "Bash(1)",
+      "Bash(xargs -r git rm --cached)"
     ],
     "deny": [],
     "ask": []
diff --git a/.env.example b/.env.example
new file mode 100644
index 00000000..004f9ab9
--- /dev/null
+++ b/.env.example
@@ -0,0 +1,27 @@
+APP_DEBUG = false
+
+[APP]
+DEFAULT_TIMEZONE = Asia/Shanghai
+
+[LANG]
+default_lang = zh-cn
+
+[DATABASE]
+TYPE = mysql
+HOSTNAME = 127.0.0.1
+DATABASE = your_database_name
+USERNAME = your_database_user
+PASSWORD = your_database_password
+HOSTPORT = 3306
+CHARSET = utf8mb4
+PREFIX = ba_
+
+[REDIS]
+HOST = 127.0.0.1
+PORT = 6379
+PASSWORD = your_redis_password
+SELECT = 0
+
+[CACHE]
+DRIVER = redis
+PREFIX = superadmin:
diff --git a/.github/workflows/ci-cd.yml b/.github/workflows/ci-cd.yml
index 1b1c6e02..30f2de5d 100644
--- a/.github/workflows/ci-cd.yml
+++ b/.github/workflows/ci-cd.yml
@@ -97,17 +97,39 @@ jobs:
         php think key:generate
         php think migrate:run
 
-    - name: Run tests
+    - name: Run tests with coverage
       run: |
-        mkdir -p build/coverage
-        vendor/bin/phpunit --coverage-clover=build/logs/clover.xml --coverage-html=build/coverage
+        mkdir -p build/coverage build/logs
+        vendor/bin/phpunit \
+          --coverage-clover=build/logs/clover.xml \
+          --coverage-html=build/coverage \
+          --coverage-text \
+          --colors=always
+
+    - name: Check coverage threshold
+      run: |
+        php -r "
+        \$xml = simplexml_load_file('build/logs/clover.xml');
+        \$metrics = \$xml->project->metrics;
+        \$elements = (int)\$metrics['elements'];
+        \$covered = (int)\$metrics['coveredelements'];
+        \$coverage = (\$covered / \$elements) * 100;
+        echo \"Coverage: \" . number_format(\$coverage, 2) . \"%\n\";
+        if (\$coverage < 70) {
+            echo \"ERROR: Coverage (\$coverage%) is below threshold (70%)\n\";
+            exit(1);
+        }
+        echo \"SUCCESS: Coverage meets threshold\n\";
+        "
 
     - name: Upload coverage reports to Codecov
+      if: always()
       uses: codecov/codecov-action@v3
       with:
         file: ./build/logs/clover.xml
         flags: backend
         name: backend-coverage
+        fail_ci_if_error: false
 
   # 前端测试
   frontend-tests:
@@ -116,32 +138,37 @@ jobs:
     - name: Checkout code
       uses: actions/checkout@v4
 
+    - name: Setup pnpm
+      uses: pnpm/action-setup@v2
+      with:
+        version: 8
+
     - name: Setup Node.js
       uses: actions/setup-node@v4
       with:
         node-version: ${{ env.NODE_VERSION }}
-        cache: 'npm'
-        cache-dependency-path: web/package-lock.json
+        cache: 'pnpm'
+        cache-dependency-path: web/pnpm-lock.yaml
 
     - name: Install frontend dependencies
       working-directory: ./web
-      run: npm ci
+      run: pnpm install --frozen-lockfile
 
     - name: Run ESLint
       working-directory: ./web
-      run: npm run lint
+      run: pnpm run lint
 
     - name: Run TypeScript type checking
       working-directory: ./web
-      run: npm run type-check
+      run: pnpm run typecheck
 
     - name: Run unit tests
       working-directory: ./web
-      run: npm run test:unit
+      run: pnpm run test
 
     - name: Build frontend
       working-directory: ./web
-      run: npm run build
+      run: pnpm run build
 
   # 构建和部署
   build-and-deploy:
@@ -159,12 +186,17 @@ jobs:
         php-version: ${{ env.PHP_VERSION }}
         extensions: mbstring, xml, ctype, iconv, intl, pdo, pdo_mysql, dom, filter, gd, hash, json, pcre, session, simplexml, spl, tokenizer, curl
 
+    - name: Setup pnpm
+      uses: pnpm/action-setup@v2
+      with:
+        version: 8
+
     - name: Setup Node.js
       uses: actions/setup-node@v4
       with:
         node-version: ${{ env.NODE_VERSION }}
-        cache: 'npm'
-        cache-dependency-path: web/package-lock.json
+        cache: 'pnpm'
+        cache-dependency-path: web/pnpm-lock.yaml
 
     - name: Get Composer Cache Directory
       id: composer-cache
@@ -185,8 +217,8 @@ jobs:
     - name: Install frontend dependencies and build
       working-directory: ./web
       run: |
-        npm ci
-        npm run build
+        pnpm install --frozen-lockfile
+        pnpm run build
 
     - name: Create deployment package
       run: |
diff --git a/.gitignore b/.gitignore
index 011df4ff..7043ad6d 100644
--- a/.gitignore
+++ b/.gitignore
@@ -21,6 +21,9 @@ dist
 dist-ssr
 .DS_Store
 /.env
+/web/.env
+/web/.env.local
+/web/.env.*.local
 Desktop.ini
 
 # Log files
diff --git a/web/.env b/web/.env
deleted file mode 100644
index e4dd6b00..00000000
--- a/web/.env
+++ /dev/null
@@ -1,5 +0,0 @@
-# port 端口号
-VITE_PORT = 1818
-
-# open 运行 npm run dev 时自动打开浏览器
-VITE_OPEN = false
diff --git a/web/.env.example b/web/.env.example
new file mode 100644
index 00000000..14ff2612
--- /dev/null
+++ b/web/.env.example
@@ -0,0 +1,11 @@
+# port 端口号
+VITE_PORT = 1818
+
+# open 运行 npm run dev 时自动打开浏览器
+VITE_OPEN = false
+
+# API 基础地址
+VITE_API_BASE_URL = http://localhost:8000
+
+# 应用标题
+VITE_APP_TITLE = Super Admin
-- 
2.45.1.windows.1

