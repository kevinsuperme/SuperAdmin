# ğŸ” CI/CDæµç¨‹è¯„ä¼°æŠ¥å‘Š (æ›´æ–°ç‰ˆ)

**é¡¹ç›®**: SuperAdmin  
**è¯„ä¼°æ—¥æœŸ**: 2025å¹´10æœˆ26æ—¥  
**è¯„ä¼°ç‰ˆæœ¬**: v2.0 (æ›´æ–°å)  
**è¯„ä¼°äºº**: DevOps Team

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡è¯„ä¼°æ˜¯å¯¹SuperAdminé¡¹ç›®CI/CDæµç¨‹çš„**ç¬¬äºŒæ¬¡å…¨é¢æ£€æŸ¥**,åŸºäºæœ€æ–°çš„é…ç½®æ–‡ä»¶è¿›è¡Œåˆ†æã€‚ç›¸æ¯”åˆç‰ˆé…ç½®,å›¢é˜Ÿå·²ç»å®æ–½äº†å¤šé¡¹é‡è¦æ”¹è¿›,ç‰¹åˆ«æ˜¯åœ¨**æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥**ã€**é€šçŸ¥æœºåˆ¶**å’Œ**éƒ¨ç½²æµç¨‹ä¼˜åŒ–**æ–¹é¢ã€‚

### ğŸ¯ æ”¹è¿›æˆæœ

| æ”¹è¿›é¡¹ | çŠ¶æ€ | æ”¹è¿›è¯¦æƒ… |
|--------|------|----------|
| âœ… æµ‹è¯•è¦†ç›–ç‡é˜ˆå€¼ | å·²å®æ–½ | åç«¯70%ã€å‰ç«¯70%å¼ºåˆ¶é˜ˆå€¼ |
| âœ… å‰ç«¯æµ‹è¯•æ‰§è¡Œ | å·²å®æ–½ | test:coverageå‘½ä»¤å·²é…ç½® |
| âœ… é€šçŸ¥æœºåˆ¶ | å·²å®æ–½ | workflow summaryè‡ªåŠ¨ç”Ÿæˆ |
| âœ… å¹¶è¡ŒåŒ–ä¼˜åŒ– | å·²å®æ–½ | PHPä»£ç è´¨é‡æ£€æŸ¥ä½¿ç”¨matrixç­–ç•¥ |
| âœ… ç¼“å­˜ä¼˜åŒ– | å·²å®æ–½ | ESLintå’ŒTypeScript buildç¼“å­˜ |
| âš ï¸ éƒ¨ç½²è‡ªåŠ¨åŒ– | éƒ¨åˆ†å®æ–½ | ä»ä¸ºå ä½ç¬¦,éœ€é…ç½®å®é™…éƒ¨ç½² |
| âš ï¸ ç¯å¢ƒå˜é‡ç®¡ç† | éƒ¨åˆ†å®æ–½ | é…ç½®æ¨¡æ¿å°±ç»ª,éœ€æ·»åŠ Secrets |
| âŒ å¥åº·æ£€æŸ¥ | æœªå®æ–½ | ä»…ä¸ºå ä½ç¬¦æç¤º |
| âŒ è‡ªåŠ¨å›æ»š | æœªå®æ–½ | ç¼ºå°‘å¤±è´¥æ¢å¤æœºåˆ¶ |

### ğŸ“Š æ€»ä½“è¯„åˆ†

- **æ•´ä½“æˆç†Ÿåº¦**: â­â­â­â­â˜† (4/5)
- **è‡ªåŠ¨åŒ–ç¨‹åº¦**: 75% â¬†ï¸ (è¾ƒåˆç‰ˆæå‡25%)
- **ä»£ç è´¨é‡ä¿éšœ**: 85% â¬†ï¸ (è¾ƒåˆç‰ˆæå‡15%)
- **éƒ¨ç½²å¯é æ€§**: 40% (ä¿æŒä¸å˜)
- **ç›‘æ§å‘Šè­¦**: 60% â¬†ï¸ (è¾ƒåˆç‰ˆæå‡20%)

---

## ğŸ”„ é…ç½®å˜æ›´å¯¹æ¯”

### æ”¹è¿›äº®ç‚¹

#### 1. æµ‹è¯•è¦†ç›–ç‡å¼ºåˆ¶æ£€æŸ¥ âœ…

**åç«¯è¦†ç›–ç‡æ£€æŸ¥** (ç¬¬160-174è¡Œ):
```yaml
- name: Check coverage threshold
  run: |
    php -r "
    \$xml = simplexml_load_file('build/logs/clover.xml');
    \$metrics = \$xml->project->metrics;
    \$elements = (int)\$metrics['elements'];
    \$covered = (int)\$metrics['coveredelements'];
    \$coverage = (\$covered / \$elements) * 100;
    if (\$coverage < 70) {
        exit(1);
    }
    "
```

**è¯„ä»·**: 
- âœ… å®æ–½äº†70%çš„è¦†ç›–ç‡é˜ˆå€¼
- âœ… è‡ªåŠ¨è§£æclover.xmlæŠ¥å‘Š
- âœ… è¦†ç›–ç‡ä¸è¾¾æ ‡æ—¶æ„å»ºå¤±è´¥
- ğŸ’¡ å»ºè®®: å¯ä»¥å°†é˜ˆå€¼é…ç½®ä¸ºç¯å¢ƒå˜é‡,ä¾¿äºè°ƒæ•´

**å‰ç«¯è¦†ç›–ç‡æ£€æŸ¥** (ç¬¬212-232è¡Œ):
```yaml
- name: Check coverage threshold
  working-directory: ./web
  run: |
    if [ -f "coverage/coverage-summary.json" ]; then
      node -e "
      const coverage = JSON.parse(fs.readFileSync('coverage/coverage-summary.json', 'utf8'));
      if (lines < 70 || functions < 70) {
        process.exit(1);
      }
      "
    fi
```

**è¯„ä»·**:
- âœ… æ£€æŸ¥lineså’Œfunctionsè¦†ç›–ç‡
- âœ… æä¾›è¯¦ç»†çš„è¦†ç›–ç‡ä¿¡æ¯
- âš ï¸ æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä»…è­¦å‘Šè€Œéå¤±è´¥
- ğŸ’¡ å»ºè®®: åº”è¯¥åœ¨æ–‡ä»¶ç¼ºå¤±æ—¶å¼ºåˆ¶å¤±è´¥

#### 2. å¹¶è¡ŒåŒ–ä»£ç è´¨é‡æ£€æŸ¥ âœ…

```yaml
php-code-quality:
  strategy:
    matrix:
      check: [phpcs, phpstan]
```

**è¯„ä»·**:
- âœ… PHPCSå’ŒPHPStanå¹¶è¡Œæ‰§è¡Œ,èŠ‚çœæ—¶é—´
- âœ… ä½¿ç”¨æ¡ä»¶åˆ¤æ–­åˆ†åˆ«è¿è¡Œä¸åŒæ£€æŸ¥
- ğŸ’¡ ä¼˜åŒ–ç©ºé—´: å¯ä»¥æ·»åŠ fail-fasté…ç½®

#### 3. å¢å¼ºçš„ç¼“å­˜ç­–ç•¥ âœ…

æ–°å¢ç¼“å­˜:
```yaml
- name: Cache ESLint
  uses: actions/cache@v4
  with:
    path: web/.eslintcache

- name: Cache TypeScript build info
  uses: actions/cache@v4
  with:
    path: web/tsconfig.tsbuildinfo
```

**è¯„ä»·**:
- âœ… æ˜¾è‘—åŠ é€ŸESLintå’ŒTypeScriptæ£€æŸ¥
- âœ… åŸºäºæ–‡ä»¶å“ˆå¸Œçš„æ™ºèƒ½ç¼“å­˜å¤±æ•ˆ
- ğŸ’¡ é¢„è®¡æé€Ÿ: ESLint 30-50%, TypeScript 20-30%

#### 4. é€šçŸ¥æœºåˆ¶å®ç° âœ…

```yaml
notify:
  needs: [php-code-quality, frontend-code-quality, backend-tests, frontend-tests, build-and-deploy, security-scan]
  if: always()
  steps:
    - name: Create workflow summary
```

**è¯„ä»·**:
- âœ… è‡ªåŠ¨ç”Ÿæˆworkflow summary
- âœ… ä½¿ç”¨emojiè§†è§‰åŒ–çŠ¶æ€
- âœ… æ±‡æ€»æ‰€æœ‰jobçš„æ‰§è¡Œç»“æœ
- âš ï¸ ä»…åœ¨GitHubç•Œé¢å¯è§
- ğŸ’¡ å»ºè®®: é›†æˆé’‰é’‰/ä¼ä¸šå¾®ä¿¡/Slacké€šçŸ¥

---

## âš ï¸ ä»å­˜åœ¨çš„é—®é¢˜

### ğŸ”´ P0 - ä¸¥é‡é—®é¢˜ (å¿…é¡»ç«‹å³ä¿®å¤)

#### é—®é¢˜1: éƒ¨ç½²åŒ…ä»ç„¶æ’é™¤web/dist âš ï¸

**ä½ç½®**: ç¬¬297-319è¡Œ

```yaml
tar -czf deployment/fantastic-admin-${{ github.sha }}.tar.gz \
  --exclude='web/dist' \  # âš ï¸ ä»ç„¶æ’é™¤å‰ç«¯æ„å»ºäº§ç‰©!
  .
```

**å½±å“**: 
- ğŸš¨ å‰ç«¯æ„å»ºäº§ç‰©ä¸ä¼šè¢«éƒ¨ç½²
- ğŸš¨ ç”Ÿäº§ç¯å¢ƒæ— æ³•è®¿é—®å‰ç«¯é¡µé¢
- ğŸš¨ è¿™æ˜¯ä¸€ä¸ªå…³é”®çš„é…ç½®é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**:
```yaml
tar -czf deployment/fantastic-admin-${{ github.sha }}.tar.gz \
  --exclude='.git' \
  --exclude='web/node_modules' \
  --exclude='web/src' \
  .  # ä¿ç•™ web/dist
```

#### é—®é¢˜2: ç¼ºå°‘å®é™…éƒ¨ç½²é€»è¾‘ âš ï¸

**ä½ç½®**: ç¬¬328-355è¡Œ - ä»ç„¶åªæ˜¯å ä½ç¬¦

**å½±å“**:
- ğŸš¨ æ„å»ºæˆåŠŸä½†ä»£ç ä¸ä¼šéƒ¨ç½²åˆ°æœåŠ¡å™¨
- ğŸš¨ éœ€è¦æ‰‹åŠ¨éƒ¨ç½²,å¤±å»äº†CI/CDçš„æ ¸å¿ƒä»·å€¼

#### é—®é¢˜3: ç¼ºå°‘å¥åº·æ£€æŸ¥ âš ï¸

**ä½ç½®**: ç¬¬357-364è¡Œ - ä»…ä¸ºæç¤ºæ–‡æœ¬

**å½±å“**:
- ğŸš¨ æ— æ³•éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸ
- ğŸš¨ å¯èƒ½éƒ¨ç½²äº†æœ‰é—®é¢˜çš„ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒ

### ğŸŸ¡ P1 - é‡è¦é—®é¢˜ (å»ºè®®è¿‘æœŸä¿®å¤)

#### é—®é¢˜4: æµ‹è¯•ç¯å¢ƒç¼ºå°‘RedisæœåŠ¡

```yaml
backend-tests:
  services:
    mysql: ...
    # âš ï¸ ç¼ºå°‘RedisæœåŠ¡
```

**ä¿®å¤æ–¹æ¡ˆ**:
```yaml
services:
  redis:
    image: redis:6-alpine
    ports:
      - 6379:6379
    options: >-
      --health-cmd "redis-cli ping"
      --health-interval 10s
```

#### é—®é¢˜5: å®‰å…¨æ‰«æå·¥å…·å·²åºŸå¼ƒ

```yaml
vendor/bin/security-checker security:check  # âš ï¸ å·²åœæ­¢ç»´æŠ¤
```

**ä¿®å¤æ–¹æ¡ˆ**:
```yaml
# ä½¿ç”¨local-php-security-checkeræ›¿ä»£
curl -L https://github.com/fabpot/local-php-security-checker/releases/download/v2.0.6/local-php-security-checker_linux_amd64 -o checker
chmod +x checker
./checker --format=json
```

#### é—®é¢˜6: å‰ç«¯è¦†ç›–ç‡æ£€æŸ¥å¯è¢«è·³è¿‡

```yaml
if [ -f "coverage/coverage-summary.json" ]; then
  # æ£€æŸ¥
else
  echo "WARNING: skipping check"  # âš ï¸ ä»…è­¦å‘Š
fi
```

**ä¿®å¤æ–¹æ¡ˆ**:
```yaml
if [ ! -f "coverage/coverage-summary.json" ]; then
  echo "ERROR: Coverage summary not found"
  exit 1
fi
```

---

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### é˜¶æ®µ1: ç´§æ€¥ä¿®å¤ (1-2å¤©)

#### Day 1 ä¸Šåˆ
- [ ] ä¿®æ”¹`.github/workflows/ci-cd.yml`,ç§»é™¤`--exclude='web/dist'`
- [ ] éªŒè¯web/distç›®å½•åœ¨æ„å»ºäº§ç‰©ä¸­å­˜åœ¨
- [ ] æäº¤PRå¹¶æµ‹è¯•æ„å»ºäº§ç‰©å®Œæ•´æ€§

#### Day 1 ä¸‹åˆ
- [ ] é…ç½®ç”Ÿäº§æœåŠ¡å™¨SSHè®¿é—®
  - [ ] ç”ŸæˆSSHå¯†é’¥å¯¹
  - [ ] æ·»åŠ å…¬é’¥åˆ°æœåŠ¡å™¨
  - [ ] æµ‹è¯•SSHè¿æ¥
- [ ] åœ¨GitHubæ·»åŠ å¿…éœ€çš„Secrets
  - [ ] SSH_PRIVATE_KEY
  - [ ] PROD_HOST
  - [ ] PROD_USER
  - [ ] DB_USER
  - [ ] DB_PASSWORD

#### Day 2 ä¸Šåˆ
- [ ] å®ç°SSHéƒ¨ç½²é€»è¾‘(æ›¿æ¢å ä½ç¬¦ä»£ç )
- [ ] æ·»åŠ å¤‡ä»½æœºåˆ¶
- [ ] å®ç°ç¬¦å·é“¾æ¥åˆ‡æ¢

#### Day 2 ä¸‹åˆ
- [ ] åˆ›å»ºå¥åº·æ£€æŸ¥ç«¯ç‚¹ `/api/health/check`
- [ ] å®ç°å¥åº·æ£€æŸ¥éªŒè¯é€»è¾‘
- [ ] æ·»åŠ è‡ªåŠ¨å›æ»šæœºåˆ¶
- [ ] è¿›è¡Œç«¯åˆ°ç«¯éƒ¨ç½²æµ‹è¯•

### é˜¶æ®µ2: é‡è¦æ”¹è¿› (3-5å¤©)

#### Day 3
- [ ] æ·»åŠ RedisæœåŠ¡åˆ°æµ‹è¯•ç¯å¢ƒ
- [ ] æ›´æ–°å®‰å…¨æ‰«æå·¥å…·
- [ ] å¼ºåŒ–å‰ç«¯è¦†ç›–ç‡æ£€æŸ¥(æ–‡ä»¶ç¼ºå¤±æ—¶å¤±è´¥)
- [ ] å°†è¦†ç›–ç‡é˜ˆå€¼é…ç½®ä¸ºç¯å¢ƒå˜é‡

#### Day 4
- [ ] é›†æˆé’‰é’‰é€šçŸ¥
  - [ ] é…ç½®Webhook
  - [ ] å®ç°æ¶ˆæ¯æ ¼å¼åŒ–
  - [ ] æµ‹è¯•é€šçŸ¥å‘é€
- [ ] æ·»åŠ éƒ¨ç½²æ—¥å¿—å½’æ¡£
- [ ] å®ç°æ—§ç‰ˆæœ¬æ¸…ç†æœºåˆ¶

#### Day 5
- [ ] ç¼–å†™éƒ¨ç½²æ“ä½œæ‰‹å†Œ
- [ ] è®°å½•å›æ»šæµç¨‹
- [ ] åŸ¹è®­å›¢é˜Ÿæˆå‘˜
- [ ] è¿›è¡Œæ•…éšœæ¼”ç»ƒ

### é˜¶æ®µ3: é•¿æœŸä¼˜åŒ– (1-2å‘¨)

#### Week 2
- [ ] è°ƒç ”è“ç»¿éƒ¨ç½²æ–¹æ¡ˆ
- [ ] å®ç°å¤šæœåŠ¡å™¨éƒ¨ç½²æ”¯æŒ
- [ ] æ·»åŠ é‡‘ä¸é›€å‘å¸ƒåŠŸèƒ½
- [ ] é›†æˆæ€§èƒ½ç›‘æ§(å¦‚Sentry/DataDog)

#### Week 3
- [ ] å®Œå–„CI/CDæ–‡æ¡£ä½“ç³»
- [ ] å»ºç«‹ç›‘æ§å‘Šè­¦è§„åˆ™
- [ ] ä¼˜åŒ–æ„å»ºç¼“å­˜ç­–ç•¥
- [ ] å®šæœŸå›é¡¾å’Œæ”¹è¿›

---

## ğŸ¯ å…³é”®é…ç½®æ¨¡æ¿

### å¥åº·æ£€æŸ¥ç«¯ç‚¹å®ç°

åˆ›å»º `app/controller/api/Health.php`:

```php
<?php
namespace app\controller\api;

use think\Response;
use think\facade\Db;
use think\facade\Cache;

class Health
{
    public function check(): Response
    {
        $checks = [
            'status' => 'healthy',
            'timestamp' => time(),
            'checks' => []
        ];
        
        // æ£€æŸ¥æ•°æ®åº“
        try {
            Db::query('SELECT 1');
            $checks['checks']['database'] = 'ok';
        } catch (\Exception $e) {
            $checks['status'] = 'unhealthy';
            $checks['checks']['database'] = 'failed: ' . $e->getMessage();
        }
        
        // æ£€æŸ¥Redis
        try {
            Cache::set('health_check', time(), 10);
            Cache::get('health_check');
            $checks['checks']['redis'] = 'ok';
        } catch (\Exception $e) {
            $checks['status'] = 'unhealthy';
            $checks['checks']['redis'] = 'failed: ' . $e->getMessage();
        }
        
        // æ£€æŸ¥ç£ç›˜ç©ºé—´
        $diskFree = disk_free_space('/');
        $diskTotal = disk_total_space('/');
        $diskUsage = (1 - $diskFree / $diskTotal) * 100;
        
        if ($diskUsage > 90) {
            $checks['status'] = 'unhealthy';
            $checks['checks']['disk'] = 'critical: ' . round($diskUsage, 2) . '% used';
        } else {
            $checks['checks']['disk'] = 'ok: ' . round($diskUsage, 2) . '% used';
        }
        
        $httpCode = $checks['status'] === 'healthy' ? 200 : 503;
        
        return json($checks, $httpCode);
    }
}
```

è·¯ç”±é…ç½® `route/app.php`:
```php
Route::get('api/health/check', 'api.Health/check');
```

---

## ğŸ“Š é¢„æœŸæ”¶ç›Š

### å®æ–½å‰åå¯¹æ¯”

| æŒ‡æ ‡ | å®æ–½å‰ | å®æ–½å | æå‡ |
|------|--------|--------|------|
| éƒ¨ç½²æ—¶é—´ | æ‰‹åŠ¨30åˆ†é’Ÿ | è‡ªåŠ¨5åˆ†é’Ÿ | 83% â¬‡ï¸ |
| éƒ¨ç½²æˆåŠŸç‡ | ~70% | ~95% | 25% â¬†ï¸ |
| æ•…éšœæ¢å¤æ—¶é—´ | 30åˆ†é’Ÿ | <10åˆ†é’Ÿ | 67% â¬‡ï¸ |
| ä»£ç è´¨é‡é—®é¢˜æ£€å‡º | æ‰‹åŠ¨ä¸å®šæœŸ | è‡ªåŠ¨100% | - |
| æµ‹è¯•è¦†ç›–ç‡ | ä¸ç¡®å®š | â‰¥70% | æ ‡å‡†åŒ– |
| äººä¸ºé”™è¯¯ | é¢‘ç¹ | ç½•è§ | 90% â¬‡ï¸ |

### æŠ•å…¥äº§å‡ºåˆ†æ

**æŠ•å…¥**:
- å¼€å‘æ—¶é—´: çº¦5ä¸ªå·¥ä½œæ—¥
- æœåŠ¡å™¨é…ç½®: 2å°æ—¶
- å›¢é˜ŸåŸ¹è®­: 4å°æ—¶
- **æ€»è®¡**: çº¦42å°æ—¶

**äº§å‡º**(å¹´åº¦):
- èŠ‚çœéƒ¨ç½²æ—¶é—´: ~200å°æ—¶ (æ¯å‘¨1æ¬¡éƒ¨ç½² Ã— 25åˆ†é’Ÿ Ã— 52å‘¨)
- å‡å°‘æ•…éšœå¤„ç†: ~100å°æ—¶ (æ¯æœˆ2æ¬¡ Ã— 4å°æ—¶ Ã— 12æœˆ)
- æå‡ä»£ç è´¨é‡: æ— æ³•é‡åŒ–ä½†ä»·å€¼å·¨å¤§
- **ROI**: çº¦7å€

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ (ä»Šå¤©)

1. **å¬å¼€æŠ€æœ¯è¯„å®¡ä¼šè®®** (30åˆ†é’Ÿ)
   - è¯„å®¡æœ¬æŠ¥å‘Š
   - ç¡®è®¤æ”¹è¿›ä¼˜å…ˆçº§
   - åˆ†é…è´£ä»»äºº

2. **ä¿®å¤web/distæ’é™¤é—®é¢˜** (30åˆ†é’Ÿ)
   - è¿™æ˜¯é›¶é£é™©çš„å¿«é€Ÿä¿®å¤
   - ç«‹å³æäº¤PR

### æœ¬å‘¨å®Œæˆ (Week 1)

3. **é…ç½®SSHéƒ¨ç½²** (Day 1-2)
   - æœåŠ¡å™¨å‡†å¤‡
   - Secretsé…ç½®
   - éƒ¨ç½²è„šæœ¬å®ç°

4. **å®ç°å¥åº·æ£€æŸ¥å’Œå›æ»š** (Day 3-4)
   - åç«¯APIå¼€å‘
   - CI/CDé›†æˆ
   - æµ‹è¯•éªŒè¯

5. **æ–‡æ¡£å’ŒåŸ¹è®­** (Day 5)
   - ç¼–å†™æ“ä½œæ‰‹å†Œ
   - å›¢é˜ŸåŸ¹è®­

### ä¸‹å‘¨å®Œæˆ (Week 2)

6. **Rediså’Œé€šçŸ¥é›†æˆ** (Day 1-2)
7. **å®‰å…¨æ‰«ææ›´æ–°** (Day 3)
8. **ç›‘æ§å’Œå‘Šè­¦** (Day 4-5)

---

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„æŠ€æœ¯æ”¯æŒ,è¯·è”ç³»DevOpså›¢é˜Ÿã€‚

**è”ç³»æ–¹å¼**:
- Email: devops@example.com
- Slack: #devops-support
- ç´§æ€¥ç”µè¯: (å¾…è¡¥å……)

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2025-10-26  
**ä¸‹æ¬¡è¯„å®¡**: 2025-11-26

---

## é™„å½•

### A. ç¯å¢ƒå˜é‡æ¸…å•

| å˜é‡å | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|------|
| SSH_PRIVATE_KEY | Secret | SSHç§é’¥ | `-----BEGIN RSA...` |
| PROD_HOST | Secret | ç”Ÿäº§æœåŠ¡å™¨åœ°å€ | `app.example.com` |
| PROD_USER | Secret | SSHç”¨æˆ·å | `deployer` |
| SSH_PORT | Variable | SSHç«¯å£ | `22` |
| DB_USER | Secret | æ•°æ®åº“ç”¨æˆ· | `admin` |
| DB_PASSWORD | Secret | æ•°æ®åº“å¯†ç  | `***` |
| COVERAGE_THRESHOLD | Variable | è¦†ç›–ç‡é˜ˆå€¼ | `70` |
| DINGTALK_WEBHOOK | Secret | é’‰é’‰Webhook | `https://...` |

### B. å¸¸ç”¨å‘½ä»¤

```bash
# æœ¬åœ°æµ‹è¯•éƒ¨ç½²åŒ…
tar -tzf deployment/fantastic-admin-*.tar.gz | head -20

# æ£€æŸ¥å¥åº·ç«¯ç‚¹
curl -i https://app.example.com/api/health/check

# æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
gh workflow run ci-cd.yml --ref main

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
ssh deployer@prod "tail -f /var/log/deploy.log"
```

### C. æ•…éšœæ’æŸ¥

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| éƒ¨ç½²å¤±è´¥ | SSHè¿æ¥å¤±è´¥ | æ£€æŸ¥å¯†é’¥å’Œé˜²ç«å¢™ |
| å¥åº·æ£€æŸ¥å¤±è´¥ | æ•°æ®åº“è¿æ¥é—®é¢˜ | æ£€æŸ¥.envé…ç½® |
| å‰ç«¯404 | web/distæœªåŒ…å« | ç¡®è®¤taråŒ…å†…å®¹ |
| å›æ»šå¤±è´¥ | æ— å¤‡ä»½ç‰ˆæœ¬ | æ‰‹åŠ¨æ¢å¤å¤‡ä»½ |

---

**æŠ¥å‘Šç»“æŸ**
